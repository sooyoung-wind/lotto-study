<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>로또 번호 생성기 (6+보너스, 이력, 테마)</title>
  <style>
    :root {
      --bg: #0b1220;
      --card: rgba(255,255,255,0.04);
      --text: #e7ecff;
      --muted: #a9b2d6;
      --border: rgba(255,255,255,0.14);
      --border2: rgba(255,255,255,0.10);
      --shadow: 0 14px 34px rgba(0,0,0,0.38);
      --pill: rgba(255,255,255,0.08);
      --pillHover: rgba(255,255,255,0.11);
      --danger: rgba(255, 80, 80, 0.14);
      --success: rgba(80, 255, 170, 0.12);
    }

    /* 라이트 테마 */
    [data-theme="light"] {
      --bg: #f4f6ff;
      --card: rgba(0,0,0,0.03);
      --text: #111827;
      --muted: #4b5563;
      --border: rgba(0,0,0,0.14);
      --border2: rgba(0,0,0,0.10);
      --shadow: 0 14px 34px rgba(17,24,39,0.12);
      --pill: rgba(0,0,0,0.06);
      --pillHover: rgba(0,0,0,0.09);
      --danger: rgba(239, 68, 68, 0.10);
      --success: rgba(16, 185, 129, 0.10);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, "Noto Sans KR", sans-serif;
      background:
        radial-gradient(1200px 600px at 20% 10%, #1a2a6c26, transparent),
        radial-gradient(900px 500px at 90% 20%, #b21f1f1e, transparent),
        radial-gradient(900px 600px at 60% 90%, #fdbb2d1e, transparent),
        var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 18px;
    }

    .card {
      width: min(720px, 100%);
      background: linear-gradient(180deg, var(--card), rgba(255,255,255,0.02));
      border: 1px solid var(--border);
      border-radius: 22px;
      box-shadow: var(--shadow);
      padding: 20px;
      backdrop-filter: blur(8px);
    }

    header {
      display: flex;
      gap: 12px;
      align-items: flex-start;
      justify-content: space-between;
      flex-wrap: wrap;
      margin-bottom: 14px;
    }

    h1 {
      font-size: 20px;
      margin: 0;
      letter-spacing: -0.3px;
    }

    .sub {
      margin: 6px 0 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.45;
    }

    .top-actions {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    button, .btn {
      appearance: none;
      border: 1px solid var(--border2);
      background: var(--pill);
      color: var(--text);
      padding: 11px 12px;
      border-radius: 12px;
      font-weight: 650;
      cursor: pointer;
      transition: transform .06s ease, background .15s ease, border-color .15s ease;
      white-space: nowrap;
    }
    button:hover, .btn:hover { background: var(--pillHover); border-color: var(--border); }
    button:active, .btn:active { transform: translateY(1px); }

    .btn-ghost { background: transparent; }
    .btn-ghost:hover { background: var(--pill); }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }

    .panel {
      border: 1px solid var(--border2);
      background: rgba(0,0,0,0.06);
      border-radius: 18px;
      padding: 14px;
    }
    [data-theme="light"] .panel {
      background: rgba(255,255,255,0.6);
    }

    .row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .meta {
      font-size: 12px;
      color: var(--muted);
      text-align: right;
      flex: 1;
      min-width: 200px;
    }

    .numbers {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      padding: 14px 10px;
      border-radius: 16px;
      border: 1px dashed var(--border);
      background: rgba(0,0,0,0.08);
      min-height: 74px;
    }
    [data-theme="light"] .numbers { background: rgba(17,24,39,0.03); }

    .ball {
      width: 52px;
      height: 52px;
      border-radius: 999px;
      display: grid;
      place-items: center;
      font-weight: 850;
      letter-spacing: -0.4px;
      border: 1px solid var(--border2);
      background: rgba(255,255,255,0.10);
      user-select: none;
    }
    [data-theme="light"] .ball { background: rgba(0,0,0,0.06); }

    .ball.bonus {
      border-color: rgba(255,255,255,0.28);
      background: linear-gradient(180deg, rgba(253,187,45,0.30), rgba(253,187,45,0.12));
    }
    [data-theme="light"] .ball.bonus {
      border-color: rgba(0,0,0,0.18);
      background: linear-gradient(180deg, rgba(253,187,45,0.35), rgba(253,187,45,0.18));
    }

    .label-row {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 10px;
      color: var(--muted);
      font-size: 12px;
    }
    .chip {
      border: 1px solid var(--border2);
      background: rgba(0,0,0,0.06);
      padding: 6px 10px;
      border-radius: 999px;
    }
    [data-theme="light"] .chip { background: rgba(0,0,0,0.04); }

    .history-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .history-title {
      margin: 0;
      font-size: 14px;
      letter-spacing: -0.2px;
    }

    .history {
      display: grid;
      gap: 8px;
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .history li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--border2);
      background: rgba(255,255,255,0.04);
    }
    [data-theme="light"] .history li { background: rgba(0,0,0,0.03); }

    .history .nums {
      font-variant-numeric: tabular-nums;
      font-weight: 700;
      letter-spacing: -0.2px;
    }
    .history .time {
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
    }

    .toast {
      margin-top: 10px;
      font-size: 12px;
      color: var(--muted);
      text-align: center;
      min-height: 18px;
    }

    .toast.ok { color: color-mix(in srgb, var(--text), #10b981 35%); }
    .toast.err { color: color-mix(in srgb, var(--text), #ef4444 35%); }

    /* 모바일: 더 크게 */
    @media (max-width: 480px) {
      h1 { font-size: 22px; }
      .sub { font-size: 14px; }
      button, .btn { padding: 13px 14px; border-radius: 14px; }
      .ball { width: 58px; height: 58px; font-size: 18px; }
      .card { padding: 18px; }
      .panel { padding: 14px; }
    }

    .sr-only {
      position: absolute;
      width: 1px; height: 1px;
      padding: 0; margin: -1px;
      overflow: hidden; clip: rect(0, 0, 0, 0);
      white-space: nowrap; border: 0;
    }
  </style>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1JD8Q57JC0"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1JD8Q57JC0');
  </script>
</head>
<body>
  <main class="card">
    <header>
      <div>
        <h1>로또 번호 생성기</h1>
        <p class="sub">버튼을 누르면 1~45 사이의 <strong>6개 번호 + 보너스 1개</strong>를 중복 없이 생성하고, 최근 10회 이력을 저장합니다.</p>
      </div>
      <div class="top-actions">
        <button id="themeToggle" type="button" class="btn-ghost" aria-label="테마 토글">테마: 다크</button>
        <button id="copyLatestBtn" type="button">최신 결과 복사</button>
      </div>
    </header>

    <div class="grid">
      <!-- 결과 패널 -->
      <section class="panel" aria-label="생성 결과">
        <div class="row">
          <button id="generateBtn" type="button" style="flex: 1; min-width: 220px;">번호 생성 (6+보너스)</button>
          <div class="meta" id="metaText">아직 생성 전</div>
        </div>

        <div class="numbers" id="numbersArea" aria-live="polite" aria-label="생성된 로또 번호">
          <span class="sr-only" id="announce"></span>
        </div>

        <div class="label-row">
          <span class="chip">일반 6개</span>
          <span class="chip">보너스 1개</span>
        </div>

        <div class="toast" id="toast" aria-live="polite"></div>
      </section>

      <!-- 이력 패널 -->
      <section class="panel" aria-label="생성 이력">
        <div class="history-head">
          <h2 class="history-title">생성 이력 (최근 10회)</h2>
          <div style="display:flex; gap:8px; flex-wrap: wrap;">
            <button id="copyHistoryBtn" type="button" class="btn-ghost">이력 전체 복사</button>
            <button id="clearHistoryBtn" type="button" class="btn-ghost">이력 삭제</button>
          </div>
        </div>

        <ul class="history" id="historyList" aria-label="로또 번호 생성 이력"></ul>
      </section>
    </div>
  </main>

  <script>
    const STORAGE_KEY = "lotto_history_v1";
    const THEME_KEY = "lotto_theme_v1";

    const generateBtn = document.getElementById("generateBtn");
    const metaText = document.getElementById("metaText");
    const numbersArea = document.getElementById("numbersArea");
    const announceEl = document.getElementById("announce");
    const toastEl = document.getElementById("toast");

    const historyList = document.getElementById("historyList");
    const copyLatestBtn = document.getElementById("copyLatestBtn");
    const copyHistoryBtn = document.getElementById("copyHistoryBtn");
    const clearHistoryBtn = document.getElementById("clearHistoryBtn");

    const themeToggle = document.getElementById("themeToggle");

    let latestResult = null; // { main: number[], bonus: number, at: ISOString }
    let history = loadHistory();

    function setToast(message, type = "") {
      toastEl.className = "toast" + (type ? " " + type : "");
      toastEl.textContent = message || "";
      if (message) {
        window.clearTimeout(setToast._t);
        setToast._t = window.setTimeout(() => {
          toastEl.textContent = "";
          toastEl.className = "toast";
        }, 1800);
      }
    }

    function nowKoreanString(d = new Date()) {
      return d.toLocaleString("ko-KR");
    }

    function getUniqueNumbers(min = 1, max = 45, count = 7) {
      const set = new Set();
      while (set.size < count) {
        const n = Math.floor(Math.random() * (max - min + 1)) + min;
        set.add(n);
      }
      return Array.from(set).sort((a, b) => a - b);
    }

    function generateLotto() {
      // 총 7개를 뽑고, 앞 6개 = 일반, 마지막 1개 = 보너스(중복 없음)
      const nums = getUniqueNumbers(1, 45, 7);
      const main = nums.slice(0, 6);
      const bonus = nums[6];

      const at = new Date();
      latestResult = { main, bonus, at: at.toISOString() };

      // 이력 업데이트(최신이 상단)
      history.unshift(latestResult);
      history = history.slice(0, 10);
      saveHistory(history);

      renderResult(latestResult);
      renderHistory(history);
    }

    function renderResult(result) {
      numbersArea.innerHTML = "";

      for (const n of result.main) {
        const ball = document.createElement("div");
        ball.className = "ball";
        ball.textContent = n;
        numbersArea.appendChild(ball);
      }

      const bonusBall = document.createElement("div");
      bonusBall.className = "ball bonus";
      bonusBall.title = "보너스 번호";
      bonusBall.textContent = result.bonus;
      numbersArea.appendChild(bonusBall);

      const when = new Date(result.at);
      metaText.textContent = `생성 시각: ${nowKoreanString(when)}`;

      const announce = `생성된 번호: ${result.main.join(", ")} / 보너스: ${result.bonus}`;
      announceEl.textContent = announce;
    }

    function formatLine(item) {
      const when = new Date(item.at);
      // 예: 2026. 1. 10. 오후 3:12:10 - 03, 11, 19, 25, 34, 41 + [07]
      const pad2 = (n) => String(n).padStart(2, "0");
      const main = item.main.map(pad2).join(", ");
      const bonus = pad2(item.bonus);
      return `${nowKoreanString(when)} - ${main} + [${bonus}]`;
    }

    function renderHistory(list) {
      historyList.innerHTML = "";

      if (!list.length) {
        const li = document.createElement("li");
        li.innerHTML = `<span class="nums" style="color: var(--muted); font-weight: 650;">이력이 없습니다. 번호를 생성해 주세요.</span>`;
        historyList.appendChild(li);
        return;
      }

      for (const item of list) {
        const li = document.createElement("li");
        const when = new Date(item.at);

        const pad2 = (n) => String(n).padStart(2, "0");
        const main = item.main.map(pad2).join(", ");
        const bonus = pad2(item.bonus);

        li.innerHTML = `
          <span class="nums">${main} <span style="opacity:.75;">+ [${bonus}]</span></span>
          <span class="time">${nowKoreanString(when)}</span>
        `;
        historyList.appendChild(li);
      }
    }

    function saveHistory(list) {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
      } catch {
        // localStorage가 막힌 경우를 대비(프라이빗 모드 등)
      }
    }

    function loadHistory() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        // 최소한의 형태 검증
        if (!Array.isArray(parsed)) return [];
        return parsed
          .filter(x => x && Array.isArray(x.main) && typeof x.bonus === "number" && typeof x.at === "string")
          .slice(0, 10);
      } catch {
        return [];
      }
    }

    async function copyText(text) {
      // Clipboard API 우선, 실패 시 fallback
      try {
        await navigator.clipboard.writeText(text);
        return true;
      } catch {
        try {
          const ta = document.createElement("textarea");
          ta.value = text;
          ta.style.position = "fixed";
          ta.style.left = "-9999px";
          document.body.appendChild(ta);
          ta.focus();
          ta.select();
          const ok = document.execCommand("copy");
          document.body.removeChild(ta);
          return ok;
        } catch {
          return false;
        }
      }
    }

    function applyTheme(theme) {
      document.documentElement.setAttribute("data-theme", theme);
      themeToggle.textContent = `테마: ${theme === "light" ? "라이트" : "다크"}`;
      try { localStorage.setItem(THEME_KEY, theme); } catch {}
    }

    function initTheme() {
      let theme = "dark";
      try {
        const saved = localStorage.getItem(THEME_KEY);
        if (saved === "light" || saved === "dark") theme = saved;
        else if (window.matchMedia && window.matchMedia("(prefers-color-scheme: light)").matches) theme = "light";
      } catch {}
      applyTheme(theme);
    }

    // 이벤트 바인딩
    generateBtn.addEventListener("click", () => {
      generateLotto();
      setToast("번호를 생성했습니다.", "ok");
    });

    copyLatestBtn.addEventListener("click", async () => {
      if (!latestResult) {
        setToast("복사할 최신 결과가 없습니다. 먼저 번호를 생성해 주세요.", "err");
        return;
      }
      const text = formatLine(latestResult);
      const ok = await copyText(text);
      setToast(ok ? "최신 결과를 복사했습니다." : "복사에 실패했습니다. 브라우저 권한을 확인해 주세요.", ok ? "ok" : "err");
    });

    copyHistoryBtn.addEventListener("click", async () => {
      if (!history.length) {
        setToast("복사할 이력이 없습니다.", "err");
        return;
      }
      const text = history.map(formatLine).join("\n");
      const ok = await copyText(text);
      setToast(ok ? "이력 전체를 복사했습니다." : "복사에 실패했습니다. 브라우저 권한을 확인해 주세요.", ok ? "ok" : "err");
    });

    clearHistoryBtn.addEventListener("click", () => {
      history = [];
      latestResult = null;
      saveHistory(history);
      renderHistory(history);
      setToast("이력을 삭제했습니다.", "ok");
    });

    themeToggle.addEventListener("click", () => {
      const current = document.documentElement.getAttribute("data-theme") || "dark";
      applyTheme(current === "dark" ? "light" : "dark");
    });

    // 초기 렌더
    initTheme();
    renderHistory(history);

    // 첫 진입 시 1회 자동 생성(원치 않으면 아래 2줄 삭제)
    generateLotto();
  </script>
</body>
</html>
